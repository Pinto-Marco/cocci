{% extends 'base.html' %} {% load static %} {% block content %} 
{% if cart_items %}
<div class="cart-summary">
  {% for item in cart_items %}
  <div class="cart-card">
    <img
      src="{{item.image}}"
      alt="product_image"
      style="height: 12rem; width: 12rem; object-fit: cover"
    />
    <div class="cart-card-title">
      <span style="font-size: 2rem; font-weight: 900;">
        {{ item.title }}
      </span>
      <div>
        <div style="margin-bottom: 0.5rem; font-size: 1.2rem;">
          {{ item.price }} EUR
        </div>
        <span style="opacity: 0.6;">
          Penalty fee: {{ item.penalty }} EUR
        </span>
      </div>
    </div>
    <div class="cart-card-controls">
      <button
          class="qty-button"
          onclick="updateCart('{{ item.code }}', -1)"
        >
          -
        </button>
        <span>{{ item.quantity }}</span>
        <button
          class="qty-button"
          onclick="updateCart('{{ item.code }}', 1)"
        >
          +
        </button>
    </div>
  </div>
  {% endfor %}
</div>

<a href="{% url 'checkout' %}" class="checkout-btn">Checkout - {{ total_price }} EUR</a>
{% else %}
<div class="checkout-btn" style="padding: 2rem;">
  Your cart is empty...
</div>
{% endif %}

<script>
  function updateCart(productCode, quantity) {
    if (quantity > 0) {
      // Add to cart
      fetch("/cart/add/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie(),
        },
        body: JSON.stringify({
          product_code: productCode,
          quantity: quantity,
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          window.location.reload();
        });
    } else {
      // Remove from cart
      fetch("/cart/remove/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie(),
        },
        body: JSON.stringify({
          product_code: productCode,
          quantity: Math.abs(quantity),
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          window.location.reload();
        });
    }
  }

  function removeFromCart(productCode) {
    fetch("/api/cart/remove/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie(),
      },
      body: JSON.stringify({
        product_code: productCode,
        remove_all: true,
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        window.location.reload();
      });
  }

  function getCookie() {
    return "{{ csrf_token }}";
  }
</script>
{% endblock %}
